<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outpost x JetBrains: Unlock revenue potential in Mexico</title>
    <style>
        /* ===== CSS Variables - Lightricks Color Scheme ===== */
        :root {
            /* Lightricks colors */
            --bg-primary: #ffffff;
            --bg-secondary: #f7f8fa;
            --bg-tertiary: #e8ebf0;
            --bg-dark: #0a0b0d;
            --border-color: #e0e3e8;
            --text-primary: #0a0b0d;
            --text-secondary: #5a6171;
            --text-tertiary: #8892a2;
            --accent: #4e5fff;
            --accent-dim: rgba(78, 95, 255, 0.1);
            --accent-hover: #3a4bff;
            --success: #4e5fff;
            --danger: #ff3b3b;
            --warning: #ffa500;
            --link-color: #4e5fff;
            
            /* Lightricks specific */
            --ltx-purple: #4e5fff;
            --ltx-purple-hover: #3a4bff;
            --ltx-purple-dim: rgba(78, 95, 255, 0.8);
            --ltx-purple-fog: rgba(78, 95, 255, 0.15);
            --ltx-pink: #ff3b3b;
            --ltx-card-bg: #ffffff;
            --ltx-card-hover: #f7f8fa;
            --ltx-gradient: linear-gradient(135deg, #4e5fff 0%, #00d4ff 100%);
        }
        
        /* Update hero background */
        .hero {
            background: var(--bg-primary);
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(78, 95, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 212, 255, 0.1) 0%, transparent 50%);
        }
        
        /* Update gradient text */
        .gradient-text {
            background: var(--ltx-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Update buttons */
        .btn {
            border-radius: 100px; /* More rounded for Lightricks style */
        }
        
        /* Update value hero */
        .value-hero::before {
            background: var(--ltx-gradient);
            opacity: 0.05;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav id="navbar">
        <div class="container">
            <div class="nav-container">
                <a href="/" class="logo">Outpost x Lightricks</a>
                <div class="nav-links">
                    <a href="#problem">Problem</a>
                    <a href="#solution">Solution</a>
                    <a href="#calculator">Calculator</a>
                    <a href="#" class="btn btn-primary" onclick="openModal()">Unlock $<span class="dynamic-value">111k</span> with Outpost</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-badge">
                <div class="badge-dot"></div>
                <span>Unlock revenue in Mexico</span>
            </div>
            
            <h1>
                Get <span class="gradient-text dynamic-percentage">10%</span> more out<br>
                of Mexico with Outpost
            </h1>
            
            <p class="hero-subtitle">
                Lightricks is leaving $<span class="dynamic-value">111k</span> on the table every year in Mexico.
                <br><br><strong>Unlock it with Outpost.</strong>
            </p>
            
            <div class="hero-buttons">
                <a href="#calculator" class="btn btn-primary">
                    Calculate impact →
                </a>
                <button class="btn btn-secondary" onclick="openModal()">
                    Book demo
                </button>
            </div>
            <div class="hero-callout">
                <p class="hero-callout-text">
                    <strong>Outpost</strong> partners with enterprises like <strong>Lightricks</strong> so they can sell in Mexico like a local. Offload your tax, compliance, payments, legal and operational burdens to Outpost.
                </p>
            </div>
        </div>
    </section>

    <!-- Problem Section -->
    <section class="section bg-secondary" id="problem">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">The hidden cost of global expansion</h2>
                <p class="section-subtitle">Global B2C software companies in to Mexico are leaving substantial value on the table every year from inefficient payments and tax infrastructure. We estimate it's costing Lightricks $<span class="dynamic-value">111k</span> per annum in churned revenue, lower margins and long tail risk management.</p>
            </div>
            
            <div class="grid-3">
                <div class="card">
                    <div class="card-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                    </div>
                    <div class="card-value">-<span class="dynamic-fx">-$45K</span></div>
                    <div class="card-label">Payment provider and FX costs</div>
                    <p class="card-description">
                        High costs of international acquiring, limited access to local APMs, rigid checkout flow and chargeback limitations.
                    </p>
                </div>
                
                <div class="card orange">
                    <div class="card-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3v18h18"></path>
                            <path d="M18.5 3.5L7 15l4 4L22 7.5"></path>
                            <circle cx="7" cy="15" r="1"></circle>
                            <circle cx="11" cy="19" r="1"></circle>
                        </svg>
                    </div>
                    <div class="card-value">-<span class="dynamic-revenue">-$180K</span></div>
                    <div class="card-label">Failed transactions</div>
                    <p class="card-description">
                        Lower approval rates mean transactions get declined and customers abandon the journey at checkout.
                    </p>
                </div>
                
                <div class="card yellow">
                    <div class="card-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 3v18M15 3v18M21 12L3 12"></path>
                            <path d="M6 6l-3 6 3 6M18 6l3 6-3 6"></path>
                        </svg>
                    </div>
                    <div class="card-value">-<span class="dynamic-compliance">-$60K+</span></div>
                    <div class="card-label">Tax compliance costs</div>
                    <p class="card-description">
                        Local compliance is costly and time consuming, and non compliance is fined at up to 70% of VAT owed per year.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Benefits Section -->
    <section class="section bg-primary" id="solution">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">The solution: <span class="gradient-text">Outpost One</span>.</h2>
                <p class="section-subtitle">
                    Outpost One is a complete Merchant of Record solution. We become the local seller for our merchants and take over local payment infrastructure, indirect tax compliance and tax liability to deliver tangible uplift to your bottom line. 
                </p>
            </div>
            
            <div class="impact-item">
                <div style="display: flex; align-items: center; gap: 24px; justify-content: center;">
                    <div class="metric-icon">
                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </div>
                    <div class="metric-value">
                        <span class="metric-number dynamic-percentage">10%+</span>
                        <span class="metric-label">Revenue uplift from localising payments</span>
                    </div>
                </div>
                <div>
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 8px;">Higher approval rates</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 24px;">In Mexico, 1 in 3 customers face payment declines, which is costing you <span style="color: var(--accent); font-weight: 600;" class="dynamic-revenue-short">$180K</span>. Outpost improves approval rates by up to 25% and offers local APMs for a frictionless payment journey.</p>
                    
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 8px;">You stay in control</h3>
                    <p style="color: var(--text-secondary);">You stay in charge of the checkout flow and your data, so you can keep optimising your customer journey.</p>
                </div>
            </div>

            <div class="impact-item">
                <div style="display: flex; align-items: center; gap: 24px; justify-content: center;">
                    <div class="metric-icon">
                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 6v6l4 2"></path>
                        </svg>
                    </div>
                    <div class="metric-value">
                        <span class="metric-number dynamic-compliance">$120K+</span>
                        <span class="metric-label dynamic-hours">& 500+ hrs saved</span>
                    </div>
                </div>
                <div>
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 8px;">Full VAT compliance</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 24px;">Avoided cost of registration, filings, and VAT advisory. The fine for non compliance is up to <span style="color: var(--accent); font-weight: 600;" class="dynamic-fines">$432K+</span>.</p>
                    
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 8px;">No registration needed</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 24px;">No RFC or FIEL required. Outpost is taxpayer of record.</p>
                </div>
            </div>

            <div class="impact-item">
                <div style="display: flex; align-items: center; gap: 24px; justify-content: center;">
                    <div class="metric-icon">
                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            <path d="M9 12l2 2 4-4"></path>
                        </svg>
                    </div>
                    <div class="metric-value">
                        <span class="metric-number dynamic-longtail">$60K+</span>
                        <span class="metric-label">Long tail liability and risk absorbed</span>
                    </div>
                </div>
                <div>
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 8px;">Transfer pricing</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 24px;">We have a very efficient structure so we can optimise TP - you do not need to set up TP, monitor it, or handle all the complexities to get an efficient structure.</p>

                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 8px;">Long term liability</h3>
                    <p style="color: var(--text-secondary);">Outpost assumes all legal and tax responsibility in-market with a dedicated legal set up.</p>
                </div>
            </div>

            <div class="value-hero">
                <div class="value-hero-content">
                    <span>Net value unlocked by Outpost</span>
                    <span class="value-highlight dynamic-total-value">+$180K annual value</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Calculator Section -->
    <section class="section bg-secondary" id="calculator">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">The impact Outpost can have<br>for Lightricks<span id="region-text"> in Mexico</span>.</h2>
            </div>

            <div class="impact-toggle">
                <button class="toggle-option active" onclick="toggleImpactView('mexico', event)">Mexico Impact</button>
                <button class="toggle-option" onclick="toggleImpactView('global', event)">Global Impact</button>
            </div>

            <!-- Global Impact Hero - New component -->
            <div class="global-impact-hero" id="global-impact-hero">
                <div class="global-impact-content">
                    <div class="global-impact-label">Total Global Value Unlocked</div>
                    <div class="global-impact-value">$18.7M</div>
                    <div class="global-impact-subtitle">We understand your problem is global, <strong>so is Outpost.</strong><br>Not only do we save you $18.7m, but you also don't have to worry about liability risk, transfer pricing, and compliance operations.</div>
                    
                    <button class="btn btn-primary" style="margin-top: 28px; font-size: 17px; padding: 14px 28px;" onclick="openModal()">
                        Unlock $18.7M globally →
                    </button>

                    <div class="global-impact-disclaimer">
                        <p class="impact-disclaimer-text">
                            This estimate is based on JetBrains' $450m global revenue across the Americas, APAC and EMEA. We assumed region specific payment and approval rates and compliance requirements. We assume that Outpost would assist with c.50% of the markets, leading to addressing c.70% of the applicable JetBrains cost base globally. The savings shown are net of the Outpost fee. This value is an indicative estimate only, based on publicly available data which may be inaccurate or incomplete. Outpost makes no warranties regarding accuracy and accept no liability for decisions made using this information. Actual impact may differ materially.
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="calculator-container" id="calculator-container">
                <div>
                    <h3 style="font-size: 24px; font-weight: 600; margin-bottom: 32px;">Your current setup</h3>
                    
                    <div class="input-group">
                        <label class="input-label">Annual revenue in Mexico</label>
                        <div class="input-wrapper">
                            <span class="input-prefix">$</span>
                            <input type="text" id="annual_revenue" class="calculator-input" value="12,000,000">
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Average transaction value</label>
                        <div class="input-wrapper">
                            <span class="input-prefix">$</span>
                            <input type="text" id="avg_transaction_value" class="calculator-input" value="25">
                        </div>
                        <span class="input-help">Average purchase amount per transaction</span>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Average Mexico approval rate</label>
                        <div class="input-wrapper">
                            <input type="range" id="current_approval" class="range-input" min="40" max="80" value="65">
                            <span class="range-value" id="current_approval_value">65%</span>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Cross-border & FX fees</label>
                        <div class="input-wrapper">
                            <input type="range" id="fx_fees" class="range-input" min="2" max="8" step="0.5" value="6">
                            <span class="range-value" id="fx_fees_value">6.0%</span>
                        </div>
                        <span class="input-help">Total payment processing and currency fees</span>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">How do you handle tax compliance in Mexico?</label>
                        <select id="compliance_status" class="calculator-input">
                            <option value="non_compliant" selected>Non compliant</option>
                            <option value="own_compliance">We do our own tax compliance</option>
                            <option value="local_partner">We use a platform</option>
                        </select>
                    </div>
                </div>
                
                <div class="calculator-results">
                    <h3 style="font-size: 24px; font-weight: 600; margin-bottom: 32px;">Your current inefficiencies</h3>
                    <div class="result-item">
                        <span class="result-label">Lost revenue to approval rate</span>
                        <span class="result-value negative">-<span id="revenue_increase">$0</span></span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Payment processing & FX fees</span>
                        <span class="result-value negative">-<span id="fx_savings">$0</span></span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Compliance costs</span>
                        <span class="result-value negative">-<span id="compliance_savings">$0</span></span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Total cost</span>
                        <span class="result-value negative">-<span id="total_inefficiency">$0</span></span>
                    </div>

                    <div class="result-item highlight">
                        <span class="result-label">Net impact of Outpost*</span>
                        <span class="result-value positive" id="total_value">+$0</span>
                    </div>

                    <button class="btn btn-primary" style="width: 100%; font-size: 18px; margin-top: 40px;" onclick="openModal()">
                        Save $<span class="dynamic-value">111k</span> — Book a demo
                    </button>

                    <p style="font-size: 12px; color: var(--text-tertiary); margin-top: 16px; text-align: center; font-style: italic;">
                        *Net value is inclusive of Outpost's flat fee
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Comparison Section -->
    <section class="section bg-primary">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">We are the only enterprise-grade MoR, delivering all of the above via your <span class="gradient-text">own dedicated Outpost entity</span></h2>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th style="background: rgba(16, 163, 127, 0.03);">
                                <div>
                                    <span>Outpost One</span>
                                    <div style="font-size: 12px; color: var(--text-secondary); font-weight: 400; margin-top: 4px;">Dedicated Entity Model</div>
                                </div>
                            </th>
                            <th style="background: rgba(239, 68, 70, 0.03);">
                                <div>
                                    <span>Traditional MoRs</span>
                                    <div style="font-size: 12px; color: var(--text-secondary); font-weight: 400; margin-top: 4px;">Shared Entity Model</div>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Legal Entity</strong></td>
                            <td style="background: rgba(16, 163, 127, 0.03);">
                                <span style="color: var(--accent); font-weight: 700;">✓</span>
                                Dedicated exclusively to your merchant
                            </td>
                            <td style="background: rgba(239, 68, 70, 0.03);">
                                <span style="color: var(--danger);">❌</span>
                                Shared across multiple merchants
                            </td>
                        </tr>
                        
                        <tr>
                            <td><strong>Risk Exposure</strong></td>
                            <td style="background: rgba(16, 163, 127, 0.03);">
                                <span style="color: var(--accent); font-weight: 700;">✓</span>
                                Fully isolated, no cross-contamination
                            </td>
                            <td style="background: rgba(239, 68, 70, 0.03);">
                                <span style="color: var(--danger);">❌</span>
                                Shared risk pool
                            </td>
                        </tr>
                        
                        <tr>
                            <td><strong>MCC Configuration</strong></td>
                            <td style="background: rgba(16, 163, 127, 0.03);">
                                <span style="color: var(--accent); font-weight: 700;">✓</span>
                                Optimized for each merchant's business
                            </td>
                            <td style="background: rgba(239, 68, 70, 0.03);">
                                <span style="color: var(--danger);">❌</span>
                                Often fixed or limited
                            </td>
                        </tr>
                        
                        <tr>
                            <td><strong>PSP Relationships</strong></td>
                            <td style="background: rgba(16, 163, 127, 0.03);">
                                <span style="color: var(--accent); font-weight: 700;">✓</span>
                                Merchant-specific terms and routing
                            </td>
                            <td style="background: rgba(239, 68, 70, 0.03);">
                                <span style="color: var(--danger);">❌</span>
                                Pooled or constrained
                            </td>
                        </tr>
                        
                        <tr>
                            <td><strong>Audit Trail</strong></td>
                            <td style="background: rgba(16, 163, 127, 0.03);">
                                <span style="color: var(--accent); font-weight: 700;">✓</span>
                                Clean, transparent records
                            </td>
                            <td style="background: rgba(239, 68, 70, 0.03);">
                                <span style="color: var(--danger);">❌</span>
                                Co-mingled activity
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="section bg-secondary" style="text-align: center; border-top: 1px solid var(--border-color);">
        <div class="container">
            <h2 class="section-title">Your apps can remove any background,<br>but they can't remove a $<span class="dynamic-value">111k</span> cash leak</h2>
            <button class="btn btn-primary" style="margin-top: 40px; font-size: 18px; padding: 16px 32px;" onclick="openModal()">
                Book demo →
            </button>
        </div>
    </section>

    <!-- Disclaimer Footer -->
    <footer class="disclaimer-footer">
        <div class="container">
            <div class="disclaimer-content">
                <p class="disclaimer-text">
                    <svg class="disclaimer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                    The cost savings estimates on this website are for informational purposes only and based on general assumptions and publicly available data. Actual results may vary significantly based on your specific business circumstances, transaction volumes, and market conditions. These estimates do not constitute guarantees, formal quotes, or professional advice. You should consult qualified advisors before making business decisions. Outpost disclaims all liability for any loss arising from reliance on these projections. Viewing this website does not create any client relationship. Governed by English law. 2025
                </p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // ===== Global Configuration =====
        const CONFIG = {
            OUTPOST_FEE_PCT: 0.07,
            TARGET_APPROVAL_RATE: 0.80,
            VAT_RATE: 0.16,
            PENALTY_RATE: 0.60,  // 60% of VAT amount as penalty
            INTEREST_RATE: 0.173,
            HOURLY_RATE: 30,
            // Long tail PE/TP risk constants
            PE_TP_DAYS_PER_YEAR: 20,  // 2 days per month
            PE_TP_HOURS_PER_DAY: 8,
            REVENUE_BOOKED_IN_MARKET: 0.06,  // 6% of revenue
            MEXICO_CORP_TAX: 0.30,  // 30%
            HOME_CORP_TAX: 0.21  // 21% (assumed US rate)
        };

        // ===== Utility Functions =====
        const utils = {
            formatCurrency(amount) {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(amount);
            },

            formatShortCurrency(amount) {
                    if (amount >= 1000000) {
                        return '$' + (amount / 1000000).toFixed(1) + 'M';
                    } else if (amount >= 1000) {
                        return '$' + Math.round(amount / 1000) + 'K';
                    }
                    return '$' + Math.round(amount);
                },

            parseNumberInput(value) {
                if (!value) return 0;
                return parseFloat(String(value).replace(/[,$]/g, '')) || 0;
            },

            formatNumberInput(value) {
                return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            }
        };

        // ===== Calculator Logic =====
        const calculator = {
            calculate() {
                try {
                    // Get inputs
                    const inputs = this.getInputs();
                    
                    // Calculate values
                    const results = this.calculateResults(inputs);
                    
                    // Update displays
                    this.updateDisplays(results);
                    
                    // Update dynamic content
                    this.updateDynamicContent(results);
                    
                } catch (error) {
                    console.error('Calculation error:', error);
                }
            },

            getInputs() {
                return {
                    annualRevenue: utils.parseNumberInput(document.getElementById('annual_revenue').value),
                    avgTransactionValue: utils.parseNumberInput(document.getElementById('avg_transaction_value').value),
                    currentApproval: parseFloat(document.getElementById('current_approval').value) / 100,
                    fxFeePct: parseFloat(document.getElementById('fx_fees').value) / 100,
                    complianceType: document.getElementById('compliance_status').value
                };
            },

            calculateResults(inputs) {
                const { annualRevenue, avgTransactionValue, currentApproval, fxFeePct, complianceType } = inputs;
                
                // Revenue increase calculation
                const approvalRateDiff = CONFIG.TARGET_APPROVAL_RATE - currentApproval;
                const revenueIncrease = approvalRateDiff * 100 * 0.003 * annualRevenue;
                
                // FX and Processing Fees
                const currentTotalFees = annualRevenue * fxFeePct;
                
                // Compliance costs - now passing avgTransactionValue
                const baseComplianceCost = this.calculateComplianceCost(annualRevenue, complianceType, avgTransactionValue);
                
                // Long tail PE/TP risks (applies to ALL scenarios)
                const longTailCost = this.calculateLongTailCost(annualRevenue);
                
                // Total compliance cost includes base + long tail
                const complianceCost = baseComplianceCost + longTailCost;
                
                // Outpost fee and total value
                const outpostFee = annualRevenue * CONFIG.OUTPOST_FEE_PCT;
                const totalInefficiency = revenueIncrease + currentTotalFees + complianceCost;
                const totalValue = totalInefficiency - outpostFee;
            
                // Additional metrics
                const hoursData = this.calculateHoursSaved(annualRevenue, complianceType);
                const vatExposure = annualRevenue * CONFIG.VAT_RATE;
                const potentialFines = vatExposure * 0.75;
                
                // Convert hours to FTE (2080 hours = 1 FTE)
                const rawFTE = hoursData.hours / 2080;
                // Ensure minimum 1 FTE, round to nearest 0.2
                const fte = Math.max(1, Math.round(rawFTE * 5) / 5);
            
                return {
                    annualRevenue,
                    revenueIncrease,
                    currentTotalFees,
                    baseComplianceCost,
                    longTailCost,
                    complianceCost,
                    outpostFee,
                    totalInefficiency,
                    totalValue,
                    hoursData,
                    fte,
                    vatExposure,
                    potentialFines,
                    inputs
                };
            },

            calculateLongTailCost(annualRevenue) {
                // Long tail risk = Corporate Tax Cost + PE/TP Management Cost
                
                // Corporate Tax Cost = 6% (revenue booked in market) × (30% - 21%) × annual revenue
                const revenueBookedInMarket = CONFIG.REVENUE_BOOKED_IN_MARKET; // 6%
                const corpTaxInMarket = CONFIG.MEXICO_CORP_TAX; // 30%
                const homeTaxRate = CONFIG.HOME_CORP_TAX; // 21%
                const taxDifferential = corpTaxInMarket - homeTaxRate; // 9%
                
                const corporateTaxCost = revenueBookedInMarket * taxDifferential * annualRevenue;
                
                // PE/TP Management Cost = hours × hourly rate
                // Assumes 2 days per month required to deal with legal and TP
                const daysPerYear = CONFIG.PE_TP_DAYS_PER_YEAR; // 20 days (2 days/month × 10 months)
                const hoursPerDay = CONFIG.PE_TP_HOURS_PER_DAY; // 8 hours
                const totalHours = daysPerYear * hoursPerDay; // 160 hours
                const peTPManagementCost = totalHours * CONFIG.HOURLY_RATE;
                
                return corporateTaxCost + peTPManagementCost;
            },

            calculateComplianceCost(annualRevenue, complianceType, avgTransactionValue) {
                switch (complianceType) {
                    case 'own_compliance':
                        // $10k one off
                        const registrationCost = 10000;
                        
                        // ($1k for first $1m revenue, then $500 for every $1m after) x 12
                        const revenueMillions = annualRevenue / 1000000;
                        const additionalMillions = Math.max(0, Math.floor(revenueMillions - 1));
                        const monthlyRepCost = 1000 + (additionalMillions * 500);
                        const annualRepCost = monthlyRepCost * 12;
                        
                        // Calculate annual transactions
                        const annualTransactions = avgTransactionValue > 0 ? annualRevenue / avgTransactionValue : 0;
                        
                        // $50 per 500 transactions x 12 (calculated as annual/12/500*50*12 = annual/500*50)
                        const annualVATCost = (annualTransactions / 500) * 50;
                        
                        // $30 per 500 transactions x 12 (calculated as annual/12/500*30*12 = annual/500*30)
                        const annualInvoiceCost = (annualTransactions / 500) * 30;
                        
                        // ($1k for first $3m revenue, then $500 for every $1m after) x 12
                        let monthlyOtherCost = 1000;
                        if (annualRevenue > 3000000) {
                            const additionalMillionsAfter3 = Math.floor((annualRevenue - 3000000) / 1000000);
                            monthlyOtherCost += additionalMillionsAfter3 * 500;
                        }
                        const annualOtherCost = monthlyOtherCost * 12;
                        
                        // $9k flat fee
                        const flatFee = 9000;
                        
                        return registrationCost + annualRepCost + annualVATCost + 
                               annualInvoiceCost + annualOtherCost + flatFee;
            
                
                case 'non_compliant':
                    // (Annual revenue x 16% x 60%) + ((Annual revenue x 16% x 60%) x 17.3%)
                    const vatAmount = annualRevenue * CONFIG.VAT_RATE;
                    const basePenalty = vatAmount * CONFIG.PENALTY_RATE;
                    const interestCharge = basePenalty * CONFIG.INTEREST_RATE;
                    return basePenalty + interestCharge;
                
                case 'local_partner':
                    // Calculate annual transactions
                    const partnerAnnualTransactions = avgTransactionValue > 0 ? annualRevenue / avgTransactionValue : 0;
                    
                    // 0.5% of revenue
                    const revenueBasedCost = annualRevenue * 0.005;
                    
                    // 0.4 * number of annual transactions
                    const transactionBasedCost = partnerAnnualTransactions * 0.40;
                    
                    // $30 per 500 transactions x 12 (calculated as annual/12/500*30*12 = annual/500*30)
                    const partnerInvoiceCost = (partnerAnnualTransactions / 500) * 30;
                    
                    // $10k base cost
                    const basePartnerCost = 10000;
                    
                    // 200 x 30
                    const additionalCost = 200 * 30;
                    
                    return revenueBasedCost + transactionBasedCost + partnerInvoiceCost + 
                           basePartnerCost + additionalCost;
                
                default:
                    return 0;
            }
            },

            calculateHoursSaved(annualRevenue, complianceType) {
                const BASE_HOURS_SAVED_WITH_PARTNER = 200;
                const PE_TP_HOURS_ANNUAL = CONFIG.PE_TP_DAYS_PER_YEAR * CONFIG.PE_TP_HOURS_PER_DAY; // 160 hours
                
                let totalHoursSaved = 0;
                
                if (complianceType === 'own_compliance' || complianceType === 'non_compliant') {
                    const complianceFTEHours = 253 * 8;
                    const managementHours = complianceFTEHours * 0.15;
                    totalHoursSaved += complianceFTEHours + managementHours;
                    totalHoursSaved += PE_TP_HOURS_ANNUAL;
                }
                
                if (complianceType === 'local_partner') {
                    totalHoursSaved += BASE_HOURS_SAVED_WITH_PARTNER;
                    totalHoursSaved += PE_TP_HOURS_ANNUAL;
                }
                
                const revenueScaling = Math.min(2, 1 + ((annualRevenue - 1000000) / 5000000));
                totalHoursSaved = Math.round(totalHoursSaved * revenueScaling);
                
                if (complianceType === 'non_compliant' && totalHoursSaved < 500) {
                    totalHoursSaved = 500;
                }
                
                return {
                    hours: totalHoursSaved,
                    cost: totalHoursSaved * CONFIG.HOURLY_RATE
                };
            },

            updateDisplays(results) {
                // Update calculator results
                document.getElementById('revenue_increase').textContent = utils.formatCurrency(results.revenueIncrease);
                document.getElementById('fx_savings').textContent = utils.formatCurrency(results.currentTotalFees);
                document.getElementById('compliance_savings').textContent = utils.formatCurrency(results.complianceCost); // This now includes long tail
                document.getElementById('total_inefficiency').textContent = utils.formatCurrency(results.totalInefficiency);
                document.getElementById('total_value').textContent = (results.totalValue > 0 ? '+' : '') + utils.formatCurrency(results.totalValue);
                
                // Update result styling
                const totalValueElement = document.getElementById('total_value');
                if (results.totalValue > 0) {
                    totalValueElement.classList.add('positive');
                    totalValueElement.classList.remove('negative');
                } else {
                    totalValueElement.classList.add('negative');
                    totalValueElement.classList.remove('positive');
                }
            },

            updateDynamicContent(results) {
                // Update all dynamic values throughout the page
                const netImpactShort = utils.formatShortCurrency(results.totalValue).substring(1);
                
                // Hero percentage: Total value as percentage of revenue
                const percentageIncrease = results.annualRevenue > 0 ? 
                    Math.round((results.totalValue / results.annualRevenue) * 100) : 10;
                
                // Revenue uplift percentage: Just the revenue increase from approval rates / total revenue
                const revenueUpliftPercentage = results.annualRevenue > 0 ? 
                    Math.round((results.revenueIncrease / results.annualRevenue) * 100) : 10;
                
                // Update Mexico-specific values in hero (these should NOT change)
                document.querySelectorAll('.dynamic-value-mexico').forEach(el => {
                    el.textContent = netImpactShort;
                });
                
                document.querySelectorAll('.dynamic-percentage-mexico').forEach(el => {
                    el.textContent = percentageIncrease + '%';
                });
                
                // Update all other dynamic values throughout the page
                document.querySelectorAll('.dynamic-value').forEach(el => {
                    el.textContent = netImpactShort;
                });
                
                // Update percentage elements differently based on context
                document.querySelectorAll('.dynamic-percentage').forEach(el => {
                    // Check if this is inside a metric-value div (the Revenue uplift section)
                    if (el.closest('.metric-value')) {
                        el.textContent = revenueUpliftPercentage + '%+';
                    } else {
                        el.textContent = percentageIncrease + '%';
                    }
                });
                
                document.querySelectorAll('.dynamic-fx').forEach(el => {
                    el.textContent = utils.formatShortCurrency(results.currentTotalFees);
                });
                
                document.querySelectorAll('.dynamic-revenue').forEach(el => {
                    el.textContent = utils.formatShortCurrency(results.revenueIncrease);
                });
                
                document.querySelectorAll('.dynamic-compliance').forEach(el => {
                    el.textContent = utils.formatShortCurrency(results.complianceCost);
                });
            
                document.querySelectorAll('.dynamic-longtail').forEach(el => {
                    el.textContent = utils.formatShortCurrency(results.longTailCost);
                });
                
                // Update short versions
                document.querySelectorAll('.dynamic-fx-short').forEach(el => {
                    el.textContent = '$' + Math.round(results.currentTotalFees / 1000) + 'K';
                });
                
                document.querySelectorAll('.dynamic-revenue-short').forEach(el => {
                    el.textContent = '$' + Math.round(results.revenueIncrease / 1000) + 'K';
                });
                
                document.querySelectorAll('.dynamic-compliance-short').forEach(el => {
                    el.textContent = '$' + Math.round(results.complianceCost / 1000) + 'K';
                });
                
                // Update other dynamic elements
                document.querySelectorAll('.dynamic-hours').forEach(el => {
                    el.textContent = "& >200 hours saved";
                });
                
                document.querySelectorAll('.dynamic-savings-label').forEach(el => {
                    const totalOperationalSavings = results.currentTotalFees + results.complianceCost;
                    el.textContent = utils.formatShortCurrency(totalOperationalSavings);
                });
                
                document.querySelectorAll('.dynamic-vat').forEach(el => {
                    el.textContent = utils.formatShortCurrency(results.vatExposure);
                });
                
                document.querySelectorAll('.dynamic-fines').forEach(el => {
                    el.textContent = utils.formatShortCurrency(results.potentialFines);
                });
                
                document.querySelectorAll('.dynamic-total-value').forEach(el => {
                    el.textContent = '+' + utils.formatCurrency(results.totalValue) + ' annual value';
                });
            }
        }

        // ===== Global Impact Toggle ===== //
                let currentView = 'mexico';
                const GLOBAL_NET_VALUE = 18684088;
                
                function toggleImpactView(view, event) {
                    currentView = view;
                    
                    // Update toggle buttons
                    document.querySelectorAll('.toggle-option').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Get the clicked button - either from event or find it by view
                    if (event && event.target) {
                        event.target.classList.add('active');
                    } else {
                        // Fallback: find the button by its onclick content
                        document.querySelectorAll('.toggle-option').forEach(btn => {
                            if ((view === 'mexico' && btn.textContent.includes('Mexico')) ||
                                (view === 'global' && btn.textContent.includes('Global'))) {
                                btn.classList.add('active');
                            }
                        });
                    }
                    
                    // Update region text in title
                    const regionText = document.getElementById('region-text');
                    regionText.textContent = view === 'mexico' ? ' in Mexico' : ' globally';
                    
                    // Show/hide elements based on view
                    const disclaimer = document.getElementById('global-disclaimer');
                    const globalHero = document.getElementById('global-impact-hero');
                    const calculatorContainer = document.getElementById('calculator-container');
                    
                    if (view === 'global') {
                        // Show global impact hero and disclaimer
                        globalHero.classList.add('active');
                        if (disclaimer) disclaimer.classList.add('active');
                        
                        // Hide the calculator container
                        calculatorContainer.classList.add('global-mode');
                        
                        // Update all dynamic values for global
                        updateGlobalDisplay();
                    } else {
                        // Show calculator and hide global elements
                        globalHero.classList.remove('active');
                        if (disclaimer) disclaimer.classList.remove('active');
                        
                        // Show the calculator container
                        calculatorContainer.classList.remove('global-mode');
                        
                        // Recalculate Mexico values
                        calculator.calculate();
                    }
                }

                
                function updateGlobalDisplay() {
                    // Update the total value in the calculator results
                    const totalValueElement = document.getElementById('total_value');
                    totalValueElement.textContent = '+' + utils.formatCurrency(GLOBAL_NET_VALUE);
                    totalValueElement.classList.add('positive');
                    totalValueElement.classList.remove('negative');
                    
                    // Update all dynamic values throughout the page to show global impact
                    const globalShortValue = utils.formatShortCurrency(GLOBAL_NET_VALUE).substring(1);
                    const globalPercentage = Math.round((GLOBAL_NET_VALUE / 450000000) * 100);
                    
                    // Update general dynamic values (NOT Mexico-specific hero values)
                    document.querySelectorAll('.dynamic-value').forEach(el => {
                        el.textContent = globalShortValue;
                    });
                    
                    document.querySelectorAll('.dynamic-percentage').forEach(el => {
                        el.textContent = globalPercentage + '%';
                    });
                    
                    document.querySelectorAll('.dynamic-total-value').forEach(el => {
                        el.textContent = '+' + utils.formatCurrency(GLOBAL_NET_VALUE) + ' annual value';
                    });

                    // Note: We do NOT update .dynamic-value-mexico or .dynamic-percentage-mexico
                    // as these should always show Mexico values
                }

        // ===== UI Functions =====
        function openModal() {
            window.open('https://calendly.com/will-outpostnow/30min', '_blank');
        }


        // ===== Initialize Everything =====
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize navbar
            window.addEventListener('scroll', () => {
                const navbar = document.getElementById('navbar');
                if (window.scrollY > 50) {
                    navbar.classList.add('scrolled');
                } else {
                    navbar.classList.remove('scrolled');
                }
            });

            // Initialize smooth scrolling
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        const offset = 80;
                        const targetPosition = target.offsetTop - offset;
                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Setup calculator inputs
            const annualRevenueInput = document.getElementById('annual_revenue');
            if (annualRevenueInput) {
                annualRevenueInput.addEventListener('input', function(e) {
                    const value = e.target.value.replace(/,/g, '');
                    if (!isNaN(value)) {
                        e.target.value = utils.formatNumberInput(value);
                        calculator.calculate();
                    }
                });
            }

            const avgTransactionInput = document.getElementById('avg_transaction_value');
            if (avgTransactionInput) {
                avgTransactionInput.addEventListener('input', function(e) {
                    const value = e.target.value.replace(/,/g, '');
                    if (!isNaN(value)) {
                        e.target.value = utils.formatNumberInput(value);
                        calculator.calculate();
                    }
                });
            }

            document.getElementById('compliance_status')?.addEventListener('change', () => calculator.calculate());

            const approvalSlider = document.getElementById('current_approval');
            if (approvalSlider) {
                approvalSlider.addEventListener('input', function(e) {
                    const value = parseFloat(e.target.value);
                    document.getElementById('current_approval_value').textContent = value + '%';
                    calculator.calculate();
                });
            }

            const fxFeesSlider = document.getElementById('fx_fees');
            if (fxFeesSlider) {
                fxFeesSlider.addEventListener('input', function(e) {
                    const value = parseFloat(e.target.value);
                    document.getElementById('fx_fees_value').textContent = value.toFixed(1) + '%';
                    calculator.calculate();
                });
            }

            // Run initial calculation
            calculator.calculate();

            // Update the calculator.updateDisplays method to check current view
            const originalUpdateDisplays = calculator.updateDisplays;
            calculator.updateDisplays = function(results) {
                if (currentView === 'mexico') {
                    originalUpdateDisplays.call(this, results);
                }
                // If global view is active, don't update with Mexico calculations
            };
            
            // Update the calculator.updateDynamicContent method to check current view
            const originalUpdateDynamicContent = calculator.updateDynamicContent;
            calculator.updateDynamicContent = function(results) {
                if (currentView === 'mexico') {
                    originalUpdateDynamicContent.call(this, results);
                }
                // If global view is active, don't update with Mexico calculations
            };

            // ===== Google Sheets Integration ===== //
            const tracking = {
                scriptURL: 'https://script.google.com/macros/s/AKfycbySzLnbf7UkA7_5EE6sm4XAJNY2j44Bim2x5wRUNXyiVW4xBi1kQv6ew8SAtcmTwizJ/exec', 
                startTime: Date.now(),
                interactions: 0,
                interactionPattern: [],
                
                // Track user interactions
                trackInteraction(type) {
                    this.interactions++;
                    this.interactionPattern.push(type);
                },
                
                // Send data to Google Sheets
                async sendToGoogleSheets(eventType = 'calculator_update') {
                    try {
                        // Get current calculator values
                        const inputs = calculator.getInputs();
                        const results = calculator.calculateResults(inputs);
                        
                        // Calculate additional metrics
                        const timeSpent = Math.round((Date.now() - this.startTime) / 1000);
                        const valueAsPercent = results.annualRevenue > 0 ? 
                            ((results.totalValue / results.annualRevenue) * 100).toFixed(2) : 0;
                        const approvalImprovement = ((CONFIG.TARGET_APPROVAL_RATE - inputs.currentApproval) * 100).toFixed(1);
                        
                        // Build the data object
                        const data = {
                            // Page info
                            page_title: document.title,
                            page_url: window.location.href,
                            
                            // Input values
                            annual_revenue: inputs.annualRevenue,
                            avg_transaction_value: inputs.avgTransactionValue,
                            approval_rate: (inputs.currentApproval * 100).toFixed(1),
                            fx_fees: (inputs.fxFeePct * 100).toFixed(1),
                            compliance_status: inputs.complianceType,
                            
                            // Calculated outputs
                            revenue_increase: Math.round(results.revenueIncrease),
                            fx_savings: Math.round(results.currentTotalFees),
                            compliance_savings: Math.round(results.baseComplianceCost), // Base compliance only
                            long_tail_costs: Math.round(results.longTailCost), // Track separately for analytics
                            total_compliance: Math.round(results.complianceCost), // Total including long tail
                            total_inefficiency: Math.round(results.totalInefficiency),
                            outpost_fee: Math.round(results.outpostFee),
                            net_impact: Math.round(results.totalValue),
                            
                            // Additional metrics
                            hours_saved: results.hoursData.hours,
                            vat_exposure: Math.round(results.vatExposure),
                            revenue_percentage: Math.round((results.totalValue / results.annualRevenue) * 100),
                            
                            // Interaction data
                            time_spent_seconds: timeSpent,
                            total_interactions: this.interactions,
                            interaction_pattern: this.interactionPattern.slice(-10).join(','), // Last 10 interactions
                            
                            // Derived metrics
                            value_as_percent: valueAsPercent,
                            approval_improvement: approvalImprovement
                        };
                        
                        // Build URL with parameters
                        const params = new URLSearchParams(data);
                        const url = `${this.scriptURL}?${params}`;
                        
                        // Send data using fetch with no-cors mode to avoid CORS issues
                        const response = await fetch(url, {
                            method: 'GET',
                            mode: 'no-cors'
                        });
                        
                        console.log('Data sent to Google Sheets', data);
                        
                    } catch (error) {
                        console.error('Error sending to Google Sheets:', error);
                    }
                },
                
                // Debounced version to avoid too many requests
                sendDebounced: (function() {
                    let timeout;
                    return function() {
                        clearTimeout(timeout);
                        timeout = setTimeout(() => {
                            tracking.sendToGoogleSheets();
                        }, 2000); // Wait 2 seconds after last change
                    };
                })()
            };
            
            // ===== Update the existing calculator object =====
            // Add this to the end of the calculator.calculate() method:
            const originalCalculate = calculator.calculate;
            calculator.calculate = function() {
                originalCalculate.call(this);
                tracking.trackInteraction('calculate');
                tracking.sendDebounced();
            };
            
            // ===== Update the existing DOMContentLoaded event listener =====
            
            // Track when users interact with inputs
            document.getElementById('annual_revenue')?.addEventListener('input', () => {
                tracking.trackInteraction('revenue_input');
            });
            
            document.getElementById('avg_transaction_value')?.addEventListener('input', () => {
                tracking.trackInteraction('transaction_input');
            });
            
            document.getElementById('current_approval')?.addEventListener('input', () => {
                tracking.trackInteraction('approval_slider');
            });
            
            document.getElementById('fx_fees')?.addEventListener('input', () => {
                tracking.trackInteraction('fx_slider');
            });
            
            document.getElementById('compliance_status')?.addEventListener('change', () => {
                tracking.trackInteraction('compliance_select');
            });
            
            // Track CTA clicks
            document.querySelectorAll('.btn-primary').forEach(btn => {
                btn.addEventListener('click', () => {
                    tracking.trackInteraction('cta_click');
                    tracking.sendToGoogleSheets('cta_click');
                });
            });
            
            // Send data when user leaves the page
            window.addEventListener('beforeunload', () => {
                tracking.sendToGoogleSheets('page_exit');
            });
            
            // Send initial page load data after a short delay
            setTimeout(() => {
                tracking.sendToGoogleSheets('page_load');
            }, 1000);
        
        });
    </script>
</body>
</html>
